![Alt text](https://i0.wp.com/neptune.ai/wp-content/uploads/2022/10/When-to-Choose-CatBoost-Over-XGBoost-or-LightGBM-Practical-Guide_13.png?resize=771%2C431&ssl=1)


***Описание основного подхода***
- Данный подход ***не требует переобучения*** при изменении файла ***buildings.csv***.
- Решалась классическая ***задача бинарной классификации***
- Подготовка датасета – датасет представлял собой эмбеддинги истинной и исходной строк, а также их разности. Также использовались строки в исходном виде в качестве text_features в catboost.
- Использованы позитивные примеры из каталога datasets, а также «испорченные» вручную адреса и пары сокращенное название – полное название из файла ***buildings.csv***.
- Использовался ***Adaptive Hard Sampling***. В качестве негативных примеров для каждого позитивного сэмплировалось несколько некорректных адресов как из полной выборки, так и из ограниченной по prefix_id, district_id, house для усложнения задачи
- Эмбеддинги генерировались с использованием библиотек ***FastText*** и ***TfidfVectorizer***, после чего считались статистики в виде квантилей.
- Дополнительно извлекались все числа, находящиеся в строке.
- В качестве модели использовался ***CatboostClassifier*** с функцией потерь ***LogLoss***
- Для инференса сравнивается каждый пример со всей базой адресов и выбирается топ K по максимизации вероятности
- Для обучения с нуля смотрите файл ***for_fit.py***

***Файл с результатами***: result.csv

***Как собрать докер***
- Скачиваем файл ***model_ft.joblib*** в папку ***data***: https://disk.yandex.ru/d/8r13dXjHYmQUSw
-  Собираем докер: ```sudo docker build --tag address_hackaton .```
-  Запускаем Docker: ```sudo docker run --publish 8000:5000 --rm address_hackaton```
-  ***Заметка!*** Сервер стартует примерно через ***30 сек***

***Либо воспользоваться уже собранным образом, залитым на Docker Hub:***
-   andrey1362010/address_hack
-   https://hub.docker.com/r/andrey1362010/address_hack

***Как делать запросы, после того как запустили Docker***
- http://localhost:8000/?query=Санкт-Петербург
- Параметр query должен быть ***URL-Encoded***

***Посмотреть пример ответа API***
<details>
  <summary>Кликни на меня!</summary>

  ```json
{
  "query:": {
    "address": "Санкт-Петербург"
  },
  "result": [
    {
      "target_address": "г.Санкт-Петербург, проспект Ветеранов, дом 169, корпус 1, строение 1",
      "target_building_id": 213833
    },
    {
      "target_address": "г.Санкт-Петербург, Лахтинский проспект, дом 2, корпус 3, строение 1",
      "target_building_id": 213245
    },
    {
      "target_address": "муниципальный округ Полюстрово, Васнецовский проспект, дом 17",
      "target_building_id": 212620
    },
    {
      "target_address": "г.Санкт-Петербург, проспект Ветеранов, дом 175, корпус 4, строение 1",
      "target_building_id": 213983
    },
    {
      "target_address": "г.Санкт-Петербург, проспект Ветеранов, дом 169, корпус 6, строение 1",
      "target_building_id": 214869
    },
    {
      "target_address": "Выборгское направление ж.д., литера V",
      "target_building_id": 201594
    },
    {
      "target_address": "г.Санкт-Петербург, проспект Ветеранов, дом 169, корпус 4, строение 1",
      "target_building_id": 216054
    },
    {
      "target_address": "г.Санкт-Петербург, проспект Ветеранов, дом 169, корпус 2, строение 1",
      "target_building_id": 211802
    },
    {
      "target_address": "г.Санкт-Петербург, проспект Ветеранов, дом 169, корпус 3, строение 1",
      "target_building_id": 211801
    },
    {
      "target_address": "г.Санкт-Петербург, участок ж.д. \"Торфяная дор. - Планерная ул.\", литера А",
      "target_building_id": 200747
    }
  ],
  "success": true
}
  ```
</details>

***Другая реализация:***
> Первой реализацией был подход через нейронные сети ***LaBSE*** и ***BERT***.
> Данный подход набрал меньший скор и более долгий в обучении и разработке, поэтому оставляем как историю.
> Смотрите файл ***Train_network.ipynb***

Суть подхода в получении вектора для каждого адресса и сравнение со списком готовых строений в файле ***buildings*** по ***Cosine distanse.csv***.
Таким образом не нужно переобучать сеть при добавлении новых адресов в этот файл.

- На вход сети ***Last Hidden State*** из ***BERT*** (Массив embeddings) для каждого адреса
- На выходе новый Embedding 
- Triplet Loss
- Поэлементное сравнение со списком адресов и поиск ***topK***
- Адаптивный ***Hard Sampling***
